name: Update Contributors

on:
  pull_request:
    types:
      - closed

permissions:
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest
    if: github.event.pull_request.merged == true
    steps:
      - name: Debug Info
        run: |
          echo "Event type: ${{ github.event_name }}"
          echo "PR merged: ${{ github.event.pull_request.merged }}"
          echo "PR author: ${{ github.event.pull_request.user.login }}"
          echo "PR number: ${{ github.event.pull_request.number }}"

      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Update README
        run: |
          # Print current content
          echo "Current README content:"
          cat README.md
          
          # Get PR author
          AUTHOR="${{ github.event.pull_request.user.login }}"
          echo "Adding contributor: $AUTHOR"
          
          # Create new entry
          NEW_ENTRY="    <td align=\"center\">\\n      <a href=\"https://github.com/$AUTHOR\">\\n        <img src=\"https://avatars.githubusercontent.com/$AUTHOR?v=4\" width=\"100px;\" alt=\"Contributor\"/>\\n        <br />\\n        <b>$AUTHOR</b>\\n      </a>\\n      <br />\\n      <sub>Contributor</sub>\\n    </td>"
          
          # Add entry before the first </tr>
          sed -i "s|</tr>|$NEW_ENTRY\\n  </tr>|" README.md
          
          echo "Updated README content:"
          cat README.md

      - name: Commit changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "docs: Add contributor ${{ github.event.pull_request.user.login }}"
          git push
